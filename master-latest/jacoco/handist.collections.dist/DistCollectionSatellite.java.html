<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DistCollectionSatellite.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">handistCollections</a> &gt; <a href="index.source.html" class="el_package">handist.collections.dist</a> &gt; <span class="el_source">DistCollectionSatellite.java</span></div><h1>DistCollectionSatellite.java</h1><pre class="source lang-java linenums">package handist.collections.dist;

import java.io.ObjectStreamException;
import java.io.Serializable;

import apgas.Constructs;
import apgas.Place;
import apgas.util.SerializableWithReplace;
import handist.collections.function.SerializableBiFunction;

/**
 * This class is used to make a distributed object that wraps a Distributed
 * Collection instance and holds some variables on places. When implementing
 * such a class called {@code DistSample}, please inherit this class and prepare
 * the method `getBranchCreator()` that defines how the class create a remote
 * branch (instance of the class) on remote places. Please see the
 * {@code DistLog} class as an sample.
 *
 *
 *
 * @param &lt;B&gt; the target DistributedCollection class to be wrapped. The instance
 *            of this class will be associated with the instance of B.
 * @param &lt;W&gt; the implementing class itself (used for methods that operate on
 *            the implementing type itself). The implementing class will be
 *            defined as
 *            {@code class DistSample extends DistCollectionSatellite&lt;P, DistSample&gt;}.
 */
public abstract class DistCollectionSatellite&lt;B extends DistributedCollection&lt;?, ? super B&gt;, W extends DistCollectionSatellite&lt;B, W&gt;&gt;
        implements SerializableWithReplace {

    public static class Handle&lt;B extends DistributedCollection&lt;?, ? super B&gt;, W extends DistCollectionSatellite&lt;B, W&gt;&gt;
            implements Serializable {
        /** Serial Version UID */
        private static final long serialVersionUID = 3644465618475412725L;
        B base;
        SerializableBiFunction&lt;B, Place, W&gt; init;

<span class="fc" id="L38">        public Handle(B base, SerializableBiFunction&lt;B, Place, W&gt; init) {</span>
<span class="fc" id="L39">            this.base = base;</span>
<span class="fc" id="L40">            this.init = init;</span>
<span class="fc" id="L41">        }</span>

        @SuppressWarnings({ &quot;unchecked&quot;, &quot;rawtypes&quot; })
        public Object readResolve() {
<span class="fc" id="L45">            DistCollectionSatellite result = base.getSatellite();</span>
<span class="fc bfc" id="L46" title="All 2 branches covered.">            if (result == null) {</span>
<span class="fc" id="L47">                result = init.apply(base, Constructs.here());</span>
<span class="fc" id="L48">                base.setSatellite(result);</span>
            }
<span class="fc" id="L50">            return result;</span>
        }
    }

    B base;

<span class="fc" id="L56">    public DistCollectionSatellite(B base) {</span>
<span class="fc" id="L57">        this.base = base;</span>
<span class="fc" id="L58">    }</span>

    /**
     * Please define how the new branch of this class will be created on remote
     * places.
     *
     * @return A initializer of the new branch that receives the wrapped distributed
     *         collection instance and the place, and creates a new branch on the
     *         place.
     */
    abstract public SerializableBiFunction&lt;B, Place, W&gt; getBranchCreator();

    protected B getPlanet() {
<span class="fc" id="L71">        return base;</span>
    }

    public Object writeReplace() throws ObjectStreamException {
<span class="fc" id="L75">        final B base0 = this.base;</span>
<span class="fc" id="L76">        final SerializableBiFunction&lt;B, Place, W&gt; init = getBranchCreator();</span>
<span class="fc" id="L77">        return new Handle&lt;&gt;(base0, init);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>