<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RangedListView.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">handistCollections</a> &gt; <a href="index.source.html" class="el_package">handist.collections</a> &gt; <span class="el_source">RangedListView.java</span></div><h1>RangedListView.java</h1><pre class="source lang-java linenums">package handist.collections;

import java.util.AbstractCollection;
import java.util.Iterator;
import java.util.function.BiConsumer;
import java.util.function.Consumer;
import java.util.function.Function;
import java.io.*;
import handist.collections.function.LongTBiConsumer;


public class RangedListView&lt;T&gt; extends AbstractCollection&lt;T&gt; implements RangedList&lt;T&gt;, Serializable {

    /** Serial Version UID */
	private static final long serialVersionUID = 8258165981421352660L;
	private RangedList&lt;T&gt; base;
    protected LongRange range;

    public static &lt;T&gt; RangedListView&lt;T&gt; emptyView() {
<span class="fc" id="L20">        return new RangedListView&lt;&gt;(null, new LongRange(0, 0));</span>
    }

<span class="fc" id="L23">    public RangedListView(RangedList&lt;T&gt; base, LongRange range) {</span>
<span class="fc" id="L24">        this.base = base;</span>
<span class="fc" id="L25">        this.range = range;</span>
<span class="fc" id="L26">    }</span>

    @Override
    public LongRange getRange() {
<span class="fc" id="L30">        return range;</span>
    }

    @Override
    public boolean contains(Object o) {
<span class="fc bfc" id="L35" title="All 2 branches covered.">        for (long i = range.from; i &lt; range.to; i++) {</span>
<span class="fc" id="L36">            T elem = base.get(i);</span>
<span class="pc bpc" id="L37" title="3 of 6 branches missed.">            if (o == null ? elem == null : o.equals(elem)) {</span>
<span class="fc" id="L38">                return true;</span>
            }
        }
<span class="fc" id="L41">        return false;</span>
    }

    @Override
    public void clear() {
<span class="fc" id="L46">        throw new UnsupportedOperationException();</span>
    }

    @Override
    public RangedList&lt;T&gt; clone() {
<span class="fc" id="L51">        return cloneRange(range);</span>
    }

    @Override
    public RangedList&lt;T&gt; cloneRange(LongRange newRange) {
<span class="fc" id="L56">        return toChunk(newRange);</span>
    }

    @Override
    public Chunk&lt;T&gt; toChunk(LongRange newRange) {
<span class="fc" id="L61">        return base.toChunk(newRange);</span>
    }

    @Override
    public Object[] toArray() {
<span class="fc" id="L66">        return base.toArray(range);</span>
    }

    @Override
    public Object[] toArray(LongRange newRange) {
<span class="nc" id="L71">        return base.toArray(newRange);</span>
    }

    @Override
    public T get(long index) {
<span class="fc" id="L76">        return base.get(index);</span>
    }

    @Override
    public T set(long index, T v) {
<span class="fc" id="L81">        return base.set(index, v);</span>
    }

    @Override
    public int size() {
<span class="fc" id="L86">        return (int) longSize();</span>
    }

    @Override
    public long longSize() {
<span class="fc" id="L91">        return range.to - range.from;</span>
    }

    private static class It&lt;T&gt; implements Iterator&lt;T&gt; {
        private long i;
        private RangedListView&lt;T&gt; rangedListView;
        private LongRange range;

<span class="nc" id="L99">        public It(RangedListView&lt;T&gt; rangedListView) {</span>
<span class="nc" id="L100">            this.rangedListView = rangedListView;</span>
<span class="nc" id="L101">            this.range = rangedListView.getRange();</span>
<span class="nc" id="L102">            this.i = range.from - 1;</span>
<span class="nc" id="L103">        }</span>

<span class="nc" id="L105">        public It(RangedListView&lt;T&gt; rangedListView, long i0) {</span>
<span class="nc" id="L106">            this.rangedListView = rangedListView;</span>
<span class="nc" id="L107">            this.range = rangedListView.getRange();</span>
<span class="nc" id="L108">            this.i = i0 - 1;</span>
<span class="nc" id="L109">        }</span>

        @Override
        public boolean hasNext() {
<span class="nc bnc" id="L113" title="All 2 branches missed.">            return i + 1 &lt; range.to;</span>
        }

        @Override
        public T next() {
<span class="nc" id="L118">            return rangedListView.get(++i);</span>
        }

    }

    @Override
    public Iterator&lt;T&gt; iterator() {
<span class="nc" id="L125">        return new It&lt;T&gt;(this);</span>
    }

    @Override
    public Iterator&lt;T&gt; iteratorFrom(long i) {
<span class="nc" id="L130">        return new It&lt;T&gt;(this, i);</span>
    }

    @Override
    public RangedList&lt;T&gt; subList(long begin, long end) {
<span class="fc" id="L135">        long from = Math.max(begin, range.from);</span>
<span class="fc" id="L136">        long to = Math.min(end, range.to);</span>
<span class="pc bpc" id="L137" title="1 of 2 branches missed.">        if (from &gt; to) {</span>
<span class="nc" id="L138">            throw new ArrayIndexOutOfBoundsException();</span>
        }
<span class="pc bpc" id="L140" title="3 of 4 branches missed.">        if (begin == range.from &amp;&amp; end == range.to) {</span>
<span class="nc" id="L141">            return this;</span>
        }
<span class="fc" id="L143">        return new RangedListView&lt;T&gt;(base, new LongRange(from, to));</span>
    }

    @Override
    public void forEach(LongRange range, Consumer&lt;? super T&gt; action) {
<span class="nc" id="L148">        rangeCheck(range);</span>
<span class="nc" id="L149">        base.forEach(range, action);</span>
<span class="nc" id="L150">    }</span>

    @Override
    public void forEach(LongRange range, LongTBiConsumer&lt;? super T&gt; action) {
<span class="nc" id="L154">        rangeCheck(range);        </span>
<span class="nc" id="L155">        base.forEach(range, action);</span>
<span class="nc" id="L156">    }</span>
    @Override
    public &lt;U&gt; void forEach(LongRange range, BiConsumer&lt;? super T, Consumer&lt;? super U&gt;&gt; action,
            Consumer&lt;? super U&gt; receiver) {
<span class="nc" id="L160">        rangeCheck(range);</span>
<span class="nc" id="L161">        base.forEach(range, action, receiver);</span>
<span class="nc" id="L162">    }</span>

    public &lt;S&gt; void setupFrom(RangedList&lt;S&gt; from, Function&lt;? super S, ? extends T&gt; func) {
<span class="nc" id="L165">        rangeCheck(from.getRange());</span>
<span class="nc" id="L166">        base.setupFrom(from, func);</span>
<span class="nc" id="L167">    }</span>

    @Override
    public String toString() {
<span class="nc" id="L171">        StringBuilder sb = new StringBuilder();</span>
<span class="nc bnc" id="L172" title="All 2 branches missed.">	if(range==null) return &quot;RangedListView in Underconstruction.&quot;;</span>
<span class="nc" id="L173">        sb.append(&quot;[&quot; + range + &quot;]&quot;);</span>
<span class="nc" id="L174">        int sz = Config.omitElementsToString ? Math.min(size(), Config.maxNumElementsToString) : size();</span>
<span class="nc" id="L175">        long c = 0;</span>
<span class="nc bnc" id="L176" title="All 2 branches missed.">        for (long i = range.from; i &lt; range.to; i++) {</span>
<span class="nc bnc" id="L177" title="All 2 branches missed.">            if (c++ &gt; 0) {</span>
<span class="nc" id="L178">                sb.append(&quot;,&quot;);</span>
            }
<span class="nc" id="L180">            sb.append(&quot;&quot; + base.get(i));</span>
<span class="nc bnc" id="L181" title="All 2 branches missed.">            if (c == sz) {</span>
<span class="nc" id="L182">                break;</span>
            }
        }
<span class="nc bnc" id="L185" title="All 2 branches missed.">        if (sz &lt; size()) {</span>
<span class="nc" id="L186">            sb.append(&quot;...(omitted &quot; + (size() - sz) + &quot; elements)&quot;);</span>
        }
        // sb.append(&quot;@&quot; + range.begin + &quot;..&quot; + last() + &quot;]&quot;);
<span class="nc" id="L189">        return sb.toString();</span>
    }

    // TODO this implement generates redundant RangedListView at receiver node.
    private void writeObject(ObjectOutputStream out) throws IOException {
<span class="fc" id="L194">        Chunk&lt;T&gt; chunk = this.toChunk(range);</span>
<span class="fc" id="L195">        out.writeObject(chunk);</span>
<span class="fc" id="L196">    }</span>

    private void readObject(ObjectInputStream in) throws IOException, ClassNotFoundException {
        @SuppressWarnings(&quot;unchecked&quot;)
<span class="fc" id="L200">        Chunk&lt;T&gt; chunk = (Chunk&lt;T&gt;) in.readObject();</span>
<span class="fc" id="L201">        this.base = chunk;</span>
<span class="fc" id="L202">        this.range = chunk.getRange();</span>
        // System.out.println(&quot;readChunk: &quot; + this);
<span class="fc" id="L204">    }</span>

    public static void main(String[] args) {
<span class="nc" id="L207">        long i = 10;</span>
<span class="nc" id="L208">        Chunk&lt;Integer&gt; c = new Chunk&lt;&gt;(new LongRange(10 * i, 11 * i));</span>
<span class="nc" id="L209">        System.out.println(&quot;prepare:&quot; + c);</span>
<span class="nc bnc" id="L210" title="All 2 branches missed.">        for (long j = 0; j &lt; i; j++) {</span>
<span class="nc" id="L211">            int v = (int) (10 * i + j);</span>
<span class="nc" id="L212">            System.out.println(&quot;set@&quot; + v);</span>
<span class="nc" id="L213">            c.set(10 * i + j, v);</span>
        }
<span class="nc" id="L215">        System.out.println(&quot;Chunk :&quot; + c);</span>
<span class="nc" id="L216">        RangedList&lt;Integer&gt; r1 = c.subList(10 * i + 0, 10 * i + 2);</span>
<span class="nc" id="L217">        RangedList&lt;Integer&gt; r2 = c.subList(10 * i + 2, 10 * i + 8);</span>
<span class="nc" id="L218">        RangedList&lt;Integer&gt; r3 = c.subList(10 * i + 8, 10 * i + 9);</span>
<span class="nc" id="L219">        RangedList&lt;Integer&gt; r4 = c.subList(10 * i + 0, 10 * i + 9);</span>
<span class="nc" id="L220">        System.out.println(&quot;RangedListView: &quot; + r1);</span>
<span class="nc" id="L221">        System.out.println(&quot;RangedListView: &quot; + r2);</span>
<span class="nc" id="L222">        System.out.println(&quot;RangedListView: &quot; + r3);</span>
<span class="nc" id="L223">        System.out.println(&quot;RangedListView: &quot; + r4);</span>
<span class="nc" id="L224">    }</span>




}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>